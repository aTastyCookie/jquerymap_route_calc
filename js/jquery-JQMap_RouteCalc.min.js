(function(e){function n(t){t.find("input").each(function(){new google.maps.places.Autocomplete(e(this)[0]);e(this).attr("placeholder","")})}function r(e){var t=window.open("","","width=300,height=300");t.document.open("text/html");t.document.write(e.html());t.document.close();t.print()}function u(t,n,r,i){var s;s=new google.maps.Map(t,{zoom:i,mapTypeId:google.maps.MapTypeId.ROADMAP});var u=n;o.geocode({address:u},function(e,t){if(t==google.maps.GeocoderStatus.OK){s.setCenter(e[0].geometry.location);var n=new google.maps.Marker({map:s,position:e[0].geometry.location});if(r!=""){var i=new google.maps.InfoWindow({content:r});i.open(s,n);google.maps.event.addListener(n,"click",function(){i.open(s,n)})}}else{alert("Geocode was not successful for the following reason: "+t)}});setTimeout(function(){e(".map_container").find("img").css({"max-width":"none","max-height":"none"})},500)}function a(t,n,r,i,o,u,a,l,c){var h=new google.maps.DirectionsRenderer({draggable:true}),p=new google.maps.DirectionsService,d=[],v;map=new google.maps.Map(t,s);h.setMap(map);h.setPanel(n);google.maps.event.addListener(h,"directions_changed",function(){if(v){d.push(v)}v=h.getDirections();f(h.directions,c)});var m=[],g=o,y={origin:r,destination:i,waypoints:m,optimizeWaypoints:a,travelMode:google.maps.DirectionsTravelMode[u]};for(var b=0;b<g.length;b++){if(g[b].value!=""){m.push({location:g[b].value,stopover:true})}}p.route(y,function(t,n){if(n==google.maps.DirectionsStatus.OK){h.setDirections(t);l.html("");var r=t.routes[0];for(var i=0;i<r.legs.length;i++){var s=i+1;l.append("<b>Route Segment: "+s+"</b><br />"+r.legs[i].start_address+" to "+r.legs[i].end_address+"<br />"+r.legs[i].distance.text+"<br /><br />")}}if(n!="OK"){alert(n);return false}setTimeout(function(){e(".map_container").find("img").css({"max-width":"none","max-height":"none"})},500)});setTimeout(function(){e(".map_container").find("img").css({"max-width":"none","max-height":"none"})},500)}function f(t,n){var r=0;var s=t.routes[0];for(i=0;i<s.legs.length;i++){r+=s.legs[i].distance.value}r=r/1e3;e(n).html("Total distance: "+r+" km")}var t="img/";var s={zoom:7,mapTypeId:google.maps.MapTypeId.ROADMAP},o=new google.maps.Geocoder;e.fn.JQMap=function(i){var s={jqm_Height:"600",jqm_Width:"800",jqm_PercentCalcPanel:"40",jqm_PercentCalcDir:"60",jqm_StartOpacity:10,jqm_OverlayColor:"#ccc",jqm_TextCalc:"ROUTE CALC FORM",jqm_TextDirection:"DIRECTIONS",jqm_PrintRouteText:"Print route",jqm_WpExtra:"You can use only 8 destinations plus start and destination, form more destination you nedd a business account",jqm_TextButtonCalc:"Calculate",jqm_TextTravelMode:"Travel Mode",jqm_TextDriving:"DRIVING",jqm_TextWalking:"WALKING",jqm_TextBicy:"BICYCLING",jqm_TextWP:"Optimize Waypoints",jqm_Fixdestination:"",jqm_TexStartPoint:"",jqm_ZoomStartPoint:17,jqm_TextButtonAdd:"Add Destination"};var o=e.extend(s,i);return this.each(function(){var i=e(this),s='<div style="padding:5px" class="container_dest">                                            <span id="marcker2"><img src="http://maps.gstatic.com/mapfiles/markers2/icon_greenB.png" alt="" style="vertical-align:middle" /></span>                                            <input type="text" value="" /><span class="elimina" style="cursor:pointer;display:none"><img src="'+t+'el.gif" alt="" /></span>                                         </div>';if(o.jqm_Width==""||o.jqm_Width==0){alert("must give a width in options to continue");i.html("must give a width in options to continue");return false}if(o.jqm_Height==""||o.jqm_Height==0){alert("must give a height in options to continue");i.html("must give a height in options to continue");return false}if(o.jqm_Fixdestination!=""){s='<input type="hidden" value="'+o.jqm_Fixdestination+'" class="final_destination" />'}var f=e(".map").length+1;i.css("width",o.jqm_Width+"px").html('<span class="jqm_option jqm_route">'+o.jqm_TextCalc+"</span> "+'<span class="jqm_option jqm_indication">'+o.jqm_TextDirection+"</span> "+'<span class="jqm_option jqm_distance"></span>'+'<div class="map_container" style="width:'+o.jqm_Width+"px;height:"+o.jqm_Height+'px;position:relative;">'+'  <div class="opacity_search" style="width:'+o.jqm_PercentCalcPanel+"%;height:100%;position:absolute;top:0px;z-index:9;filter:alpha(opacity="+o.jqm_StartOpacity*10+");-moz-opacity:"+o.jqm_StartOpacity/10+";opacity:"+o.jqm_StartOpacity/10+";background:"+o.jqm_OverlayColor+';left:0px;display:none"></div>'+'  <div class="opacity_panel" style="width:'+o.jqm_PercentCalcDir+"%;height:100%;position:absolute;top:0px;z-index:9;filter:alpha(opacity="+o.jqm_StartOpacity*10+");-moz-opacity:"+o.jqm_StartOpacity/10+";opacity:"+o.jqm_StartOpacity/10+";background:"+o.jqm_OverlayColor+';right:0px;display:none"></div>'+'  <div class="panel" style="overflow:auto;width:'+o.jqm_PercentCalcDir+'%;height:100%;position:absolute;top:0px;z-index:999;right:0px;display:none"></div>'+'  <div class="form_search" style="height:100%;width:'+o.jqm_PercentCalcPanel+'%;overflow:auto;position:absolute;z-index:99;top:0px;left:0px;display:none">'+'    <div class="destinations">'+'      <div style="padding:5px" class="container_dest">'+'         <span id="marcker1"><img src="http://maps.gstatic.com/mapfiles/markers2/icon_greenA.png" alt="" style="vertical-align:middle" /></span><input type="text" value="" /><span class="elimina" style="cursor:pointer;display:none"><img src="'+t+'el.gif" alt="" /></span>'+"      </div>"+s+"    </div>"+o.jqm_TextTravelMode+'<br/><select class="TravelMode">'+'     <option value="DRIVING" selected="selected">'+o.jqm_TextDriving+"</option>"+'     <option value="WALKING">'+o.jqm_TextWalking+"</option>"+'     <option value="BICYCLING">'+o.jqm_TextBicy+"</option>"+'    </select> <input type="checkbox" name="opt_wp" class="opt_wp" id="'+f+'" value="1" /><label for="'+f+'">'+o.jqm_TextWP+"</label><br/>"+'    <button class="button-primary add_destination"><img style="vertical-align:middle" src="'+t+'add.png" alt="" /><span>'+o.jqm_TextButtonAdd+"</span></button>"+'    <button class="button-primary start_calc"><img style="vertical-align:middle" src="'+t+'calc.png" alt="" /><span>'+o.jqm_TextButtonCalc+"</span></button>"+'    <button class="button-primary print_route"><img style="vertical-align:middle" src="'+t+'print_route.png" alt="" /><span>'+o.jqm_PrintRouteText+"</span></button>"+"   </div>"+'   <div class="map" style="width:100%;height:100%;"><div style="width:100%;text-align:center;position:absolute;top:50%;">CLICK ON ROUTE CALC FORM AND START</div></div>'+'   <div class="printable_panel" style="display:none;"></div>'+"  </div>");var l=i.find(".start_calc"),c=i.find(".map"),h=i.find(".jqm_distance"),p=i.find(".panel"),d=i.find(".destinations"),v=i.find(".add_destination"),m=i.find(".jqm_route"),g=i.find(".jqm_indication"),y=i.find(".TravelMode"),b=i.find(".printable_panel"),w=i.find(".opt_wp"),E=i.find(".print_route"),S=i.find(".form_search"),x=i.find(".opacity_search"),T=i.find(".opacity_panel"),N=",A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z",C=N.split(",");n(d);l.click(function(){a(c[0],p[0],d.find("input:first").val(),d.find("input:last").val(),i.find(".wp"),y.val(),w.prop("checked"),b,h)});y.change(function(){a(c[0],p[0],d.find("input:first").val(),d.find("input:last").val(),i.find(".wp"),e(this).val(),w.prop("checked"),b,h)});w.click(function(){a(c[0],p[0],d.find("input:first").val(),d.find("input:last").val(),i.find(".wp"),y.val(),e(this).prop("checked"),b,h)});E.click(function(){r(b)});if(o.jqm_Fixdestination!=""){u(c[0],o.jqm_Fixdestination,o.jqm_TexStartPoint,o.jqm_ZoomStartPoint)}v.click(function(){if(d.find("input").length>=10){alert(o.jqm_WpExtra);return false}var r=d.find("input").not(".final_destination").length+1,s='<img src="http://maps.gstatic.com/mapfiles/markers2/icon_green'+C[r]+'.png" alt="" style="vertical-align:middle" />';if(o.jqm_Fixdestination!=""){e('<div style="padding:5px" class="container_dest"><span id="marcker'+r+'">'+s+'</span><input type="text" value="" /><span class="elimina" style="cursor:pointer"><img src="'+t+'el.gif" alt="" /></span></div>').insertBefore(d.find(".final_destination"))}else{d.append('<div style="padding:5px" class="container_dest"><span id="marcker'+r+'">'+s+'</span><input type="text" value="" /><span class="elimina" style="cursor:pointer"><img src="'+t+'el.gif" alt="" /></span></div>')}d.find("input").not(".final_destination").addClass("wp");d.find("input:first,input:last").not(".final_destination").removeClass("wp");if(o.jqm_Fixdestination!=""){var u=2}else{var u=3}if(d.find("input").not(".final_destination").length<u){d.find("input").not(".final_destination").eq(0).next("span").css("display","none");d.find("input").not(".final_destination").eq(1).next("span").css("display","none")}else{d.find("input").not(".final_destination").next("span").css("display","")}n(d);i.find(".elimina").click(function(){e(this).parent("div").remove();d.find(".container_dest").each(function(t){t++;s='<img src="http://maps.gstatic.com/mapfiles/markers2/icon_green'+C[t]+'.png" alt="" style="vertical-align:middle" />';e(this).find('span[id^="marcker"]').attr({id:"marcker"+t}).html(s)});var t=d.find("input").not(".final_destination").length;d.find("input").not(".final_destination").addClass("wp");d.find("input:first,input:last").not(".final_destination").removeClass("wp");if(d.find("input").not(".final_destination").length<u){d.find("input").not(".final_destination").eq(0).next("span").css("display","none");d.find("input").not(".final_destination").eq(1).next("span").css("display","none")}else{d.find("input").not(".final_destination").next("span").css("display","")}n(d)})});m.click(function(){e(this).toggleClass("jqm_option-c");S.slideToggle("slow");x.slideToggle("slow")});g.click(function(){e(this).toggleClass("jqm_option-c");p.slideToggle("slow");T.slideToggle("slow")})})}})(jQuery);